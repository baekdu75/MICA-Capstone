<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>EV vs. Gas — Monthly Cost</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Chart.js + Papa Parse (CDNs) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  
  <style>
    :root { --bg:#fff; --fg:#1f1f33; --muted:#6b6b80; --accent:#5b7cfa; }
    body { font: 16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Arial; color:var(--fg); background:var(--bg); margin:0; }
    .wrap { max-width: 960px; margin: 32px auto; padding: 0 16px; }
    h1 { margin: 0 0 8px; }
    .panel { display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); padding: 16px; border: 1px solid #ececf5; border-radius: 12px; background:#fafafe;}
    label { font-weight: 750; display: block; margin-bottom: 4px; }
    select, input[type="number"] { width: 100%; padding: 10px 12px; border:1px solid #dcdceb; border-radius:10px; background:#fff; color:var(--fg); }
    input[type="range"] { width: 100%; }
    .hint { color: var(--muted); font-size: 13px; margin-top: 4px; }
    canvas { background:#fff; border:1px solid #ececf5; border-radius:12px; padding:8px; }
    .advanced-toggle { margin: 24px 0 12px; padding: 12px 16px; background: #f5f5fa; border: 1px solid #dcdceb; border-radius: 10px; cursor: pointer; user-select: none; display: flex; align-items: center; justify-content: space-between; }
    .advanced-toggle:hover { background: #ececf5; }
    .advanced-toggle-title { font-weight: 600; font-size: 15px; }
    .advanced-toggle-arrow { transition: transform 0.2s; font-size: 18px; }
    .advanced-toggle-arrow.open { transform: rotate(180deg); }
    .advanced-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
    .advanced-content.open { max-height: 800px; }
    .radio-container { display: flex; gap: 20px; margin-top: 8px; }
    .radio-option { display: flex; align-items: center; gap: 6px; }
    .radio-option input[type="radio"] { width: auto; cursor: pointer; }
    .radio-option label { margin: 0; cursor: pointer; font-weight: normal; }
    .status { padding: 8px 12px; border-radius: 8px; font-size: 14px; margin-bottom: 16px; }
    .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .vehicle-image { width: 100%; max-width: 300px; height: 150px; object-fit: contain; border-radius: 8px; background: #ffffff; margin-top: 12px; border: 1px solid #dcdceb; }
  </style>
</head>
  
<body>
  <div class="wrap">
    <h1>Real Cost of EV Ownership vs. Hybrid & Gasoline</h1>
    
    <div id="csvStatus"></div>

    <div class="panel">
      <div>
        <label for="state">Step-1. Select your state of residence</label>
        <!--<div class="hint">We'll use your state's average residential electricity rate and gas price.</div>-->
        <select id="state"></select>
      </div>
    </div>
    <br>
    
    <div class="panel">
      <div>
        <label for="miles">Step-2. Choose your driving profile</label>
        <!--<div class="hint">Select the profile that best matches your driving habits.</div>-->
        <select id="miles">
          <option value="">-- Select your driving profile --</option>
          <option value="4000">Minimal (5,000 miles/yr) - Walk/transit, short errands, 1-2 days/week</option>
          <option value="7000">Light (7,000 miles/yr) - Local commute, 2-3 days/week, few trips</option>
          <option value="10000">Typical (10,000 miles/yr) - Standard usage, 4-5 days/week</option>
          <option value="13000">Heavy Commute (13,000 miles/yr) - Daily commute, longer drives</option>
          <option value="18000">High Mileage (18,000 miles/yr) - Field work, frequent trips</option>
        </select>
      </div>
    </div>
    <br>
    
    <div class="panel">
      <div>
        <label>Step-3. Choose your vehicles</label>
        <div class="hint">Choose your electric vehicle.</div>
        <select id="evModel">
          <option value="Model 3">Tesla Model 3</option>
          <option value="Model Y" selected>Tesla Model Y</option>
          <option value="Model S">Tesla Model S</option>
          <option value="Model X">Tesla Model X</option>
        </select>
        <img id="evImage" class="vehicle-image" src="https://via.placeholder.com/300x150/7c6cf3/ffffff?text=Tesla+Model+Y" alt="EV" width=550>
      </div>

      <div>
        <label>&nbsp;</label>
        <div class="hint">Choose your hybrid vehicle.</div>
        <select id="hybridModel">
          <option value="Toyota Prius" selected>Toyota Prius</option>
          <option value="Toyota RAV4">Toyota RAV4 Hybrid</option>
          <option value="Honda Accord Hybrid">Honda Accord Hybrid</option>
          <option value="Toyota Camry">Toyota Camry Hybrid</option>
          <option value="Toyota Highlander">Toyota Highlander Hybrid</option>

        </select>
        <img id="hybridImage" class="vehicle-image" src="https://via.placeholder.com/300x150/b9a7ff/ffffff?text=Toyota+Prius" alt="Hybrid" width=550>
      </div>

      <div>
        <label>&nbsp;</label>
        <div class="hint">Choose your gasoline vehicle.</div>
        <select id="gasModel">
          <option value="Honda Civic" selected>Honda Civic</option>
          <option value="Honda CR-V">Honda CR-V</option>
          <option value="Toyota Camry">Toyota Camry</option>
          <option value="Toyota RAV4">Toyota RAV4</option>
          <option value="Chevy Equinox">Chevy Equinox</option>
        </select>
        <img id="gasImage" class="vehicle-image" src="https://via.placeholder.com/300x150/e1d8ff/ffffff?text=Honda+Civic" alt="Gas" width=550>
      </div>
    </div>
    
    <div class="advanced-toggle" id="advancedToggle">
      <span class="advanced-toggle-title">⚙️ Advanced Configuration</span>
      <span class="advanced-toggle-arrow">▼</span>
    </div>

    <div class="advanced-content" id="advancedContent">
      <div class="panel">
        <div>
          <label>Do you need to install a home EV charger?</label>
          <div class="radio-container">
            <div class="radio-option">
              <input type="radio" id="needsChargerYes" name="needsCharger" value="yes" />
              <label for="needsChargerYes">Yes</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="needsChargerNo" name="needsCharger" value="no" checked />
              <label for="needsChargerNo">No</label>
            </div>
          </div>
          <div class="hint">If yes, will add an estimated $1,500 cost.</div>
        </div>

        <div>
          <label for="homeChargePct">Percent of your charging is at home</label>
          <input id="homeChargePct" type="range" min="0" max="100" value="80" />
          <div class="hint">
            <span id="homeChargePctValue">80</span>% at home, 
            <span id="publicChargePctValue">20</span>% at public (charged $0.50/kWh)
          </div>
        </div>
      </div>
    </div>

    <div style="margin:18px 0;"></div>
    <canvas id="chart" height="140"></canvas>
  </div>

  <script>
    // ---------- Constants & defaults ----------
    const CHARGER_COST = 1500;
    let electricityCentsPerKwhByState = {};
    let gasolinePerGallonByState = {};

    const DEFAULTS = {
      evKwhPer100: 28,
      hybridMpg: 50,
      mpg: 30,
      insEV: 140,
      insHybrid: 130,
      insGas: 120,
      maintEV: 25,
      maintHybrid: 45,
      maintGas: 60,
      chargerLifeMonths: 120
    };

    // Vehicle image URLs (using placeholder - replace with real images)
    const VEHICLE_IMAGES = {
      'Model 3': 'Model-3.png',
      'Model Y': 'Model-Y.png',
      'Model S': 'Model-S.png',
      'Model X': 'Model-X.png',
      'Toyota Prius': 'Toyota_Prius.png',
      'Toyota RAV4': 'RAV-4-Hybrid.png',
      'Honda Accord Hybrid': 'Accord-Hybrid.png',
      'Toyota Highlander': 'Highlander-Hybrid.png',
      'Toyota Camry': 'Camry-Hybrid.png',
      'Honda Civic': 'Honda_Civic.png',
      'Honda CR-V': 'CR-V.png',
      'Toyota RAV4': 'RAV-4.png',
      'Chevy Equinox': 'Equinox.png'
    };

    const $ = id => document.getElementById(id);
    const csvStatus = $('csvStatus');
    const stateSel = $('state');

    // ---------- Build state dropdown ----------
    function populateStateDropdown() {
      stateSel.innerHTML = '';
      const emptyOption = document.createElement('option');
      emptyOption.value = '';
      emptyOption.textContent = '-- Select a state --';
      stateSel.appendChild(emptyOption);

      Object.keys(electricityCentsPerKwhByState).sort().forEach(s => {
        const o = document.createElement('option');
        o.value = o.textContent = s;
        stateSel.appendChild(o);
      });
      stateSel.value = '';
    }

    // ---------- Update vehicle images ----------
    function updateVehicleImages() {
      const evModel = $('evModel').value;
      const hybridModel = $('hybridModel').value;
      const gasModel = $('gasModel').value;

      $('evImage').src = VEHICLE_IMAGES[evModel] || VEHICLE_IMAGES['Model Y'];
      $('hybridImage').src = VEHICLE_IMAGES[hybridModel] || VEHICLE_IMAGES['Toyota Prius'];
      $('gasImage').src = VEHICLE_IMAGES[gasModel] || VEHICLE_IMAGES['Honda Civic'];
    }

    // ---------- CSV load ----------
    window.addEventListener('DOMContentLoaded', function () {
      const csvFileName = 'state_energy_prices.csv';
      csvStatus.innerHTML = '<div class="status">Loading state data...</div>';

      Papa.parse(csvFileName, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function (results) {
          const newElectricity = {};
          const newGasoline = {};
          let successCount = 0;

          results.data.forEach((row, i) => {
            const state = row.state ? String(row.state).trim() : '';
            if (!state) return;

            const elecPrice = parseFloat(row['electricity price']);
            const gasPrice  = parseFloat(row['gasoline price']);

            if (Number.isFinite(elecPrice) && elecPrice > 0 &&
                Number.isFinite(gasPrice)  && gasPrice  > 0) {
              newElectricity[state] = elecPrice;
              newGasoline[state] = gasPrice;
              successCount++;
            }
          });

          if (successCount > 0) {
            electricityCentsPerKwhByState = newElectricity;
            gasolinePerGallonByState = newGasoline;
            populateStateDropdown();
            csvStatus.innerHTML = `<div class="status success">✓ Loaded data for ${successCount} states</div>`;
            setTimeout(() => { csvStatus.innerHTML = ''; }, 2500);
          } else {
            csvStatus.innerHTML = '<div class="status error">✗ No valid data found in CSV.</div>';
          }
        },
        error: function (error) {
          csvStatus.innerHTML = `<div class="status error">✗ CSV file not found: ${error.message}</div>`;
          console.error('CSV load error:', error);
        }
      });

      // Initialize vehicle images
      updateVehicleImages();
    });

    // ---------- Advanced toggle ----------
    const advToggle = $('advancedToggle');
    const advContent = $('advancedContent');
    const advArrow = advToggle.querySelector('.advanced-toggle-arrow');
    advToggle.addEventListener('click', () => {
      advContent.classList.toggle('open');
      advArrow.classList.toggle('open');
    });

    // ---------- Radio bindings ----------
    const needsChargerYes = $('needsChargerYes');
    const needsChargerNo  = $('needsChargerNo');
    needsChargerYes.addEventListener('change', recalc);
    needsChargerNo.addEventListener('change', recalc);

    // ---------- Slider bindings ----------
    const homeSlider = $('homeChargePct');
    const homeVal = $('homeChargePctValue');
    const publicVal = $('publicChargePctValue');
    homeSlider.addEventListener('input', () => {
      const v = parseInt(homeSlider.value, 10) || 0;
      homeVal.textContent = v;
      publicVal.textContent = 100 - v;
      recalc();
    });

    // ---------- Math ----------
    function monthlyCosts({ state, annualMiles, needsCharger, homeChargePct }) {
      const homeKwhPrice = (electricityCentsPerKwhByState[state] ?? 15) / 100;
      const gasPrice = gasolinePerGallonByState[state] ?? 3.5;
      const publicChargeRate = 0.50;

      const ev_kwh_year = (DEFAULTS.evKwhPer100 / 100) * annualMiles;
      const homeFrac   = homeChargePct / 100;
      const publicFrac = 1 - homeFrac;

      const homeChargeYear   = ev_kwh_year * homeFrac  * homeKwhPrice;
      const publicChargeYear = ev_kwh_year * publicFrac * publicChargeRate;
      const evFuelYear       = homeChargeYear + publicChargeYear;

      const hybridFuelYear = (annualMiles / DEFAULTS.hybridMpg) * gasPrice;
      const gasFuelYear    = (annualMiles / DEFAULTS.mpg) * gasPrice;

      const evFuelMonth     = evFuelYear / 12;
      const hybridFuelMonth = hybridFuelYear / 12;
      const gasFuelMonth    = gasFuelYear / 12;

      const chargerMonthly = needsCharger ? (CHARGER_COST / DEFAULTS.chargerLifeMonths) : 0;

      return { evFuelMonth, hybridFuelMonth, gasFuelMonth, chargerMonthly };
    }

    // ---------- Chart ----------
    const ctx = document.getElementById('chart');
    const chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['EV','Hybrid','Gasoline'],
        datasets: [
          { label:'Fuel/Charge', data:[0,0,0], backgroundColor:'#7c6cf3' },
          { label:'Insurance',   data:[0,0,0], backgroundColor:'#b9a7ff' },
          { label:'Maintenance', data:[0,0,0], backgroundColor:'#e1d8ff' },
          { label:'Charger (amortized)', data:[0,0,0], backgroundColor:'#ffa07a' }
        ]
      },
      options: {
        responsive:true,
        scales: {
          x: { stacked:true },
          y: { stacked:true, beginAtZero:true, title:{ display:true, text:'$/month'} }
        },
        plugins: {
          legend: { position:'bottom' },
          tooltip: { mode:'index', intersect:false }
        }
      }
    });

    // ---------- Recalc ----------
    function recalc() {
      const state = $('state').value;
      const miles = $('miles').value;

      if (state && miles) {
        const result = monthlyCosts({
          state,
          annualMiles: parseInt(miles, 10) || 0,
          needsCharger: $('needsChargerYes').checked,
          homeChargePct: parseInt($('homeChargePct').value, 10) || 0
        });

        chart.data.datasets[0].data = [result.evFuelMonth, result.hybridFuelMonth, result.gasFuelMonth];
        chart.data.datasets[3].data = [result.chargerMonthly, 0, 0];
      }

      chart.data.datasets[1].data = [DEFAULTS.insEV, DEFAULTS.insHybrid, DEFAULTS.insGas];
      chart.data.datasets[2].data = [DEFAULTS.maintEV, DEFAULTS.maintHybrid, DEFAULTS.maintGas];

      chart.update();
    }

    // Bind events
    ['state','miles','homeChargePct','evModel','hybridModel','gasModel'].forEach(id => {
      $(id).addEventListener('change', () => {
        updateVehicleImages();
        recalc();
      });
    });
    $('homeChargePct').addEventListener('input', recalc);
  </script>
</body>
</html>



